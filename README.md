# U-Netによる単一画像からの反射率・法線・深度推定（点光源・透視投影下）

本プロジェクトでは、**点光源照明および透視投影環境下において、単一視点画像から反射率・法線・深度を同時に推定する深層学習手法**を提案・実装しています。

---

## 🔍 背景と目的

従来の Shape from Shading 手法は**平行光源・平行投影という理想条件**に依存しており、現実のシーンへの適用に限界があります。  
本研究では、より実環境に近い**点光源および透視投影モデル**を採用し、**深度推定の曖昧性を軽減**することを目指します。

---

## 🛠 使用技術

- **レンダリング**：Mitsuba3 を用いて 3D モデルから RGB・反射率・法線・深度マップを生成  
- **ネットワーク**：PyTorch ベースのマルチ出力 U-Net  
- **損失関数**：
  - 反射率：`MSE（平均二乗誤差）`
  - 法線：`コサイン類似度損失`
  - 深度：`SSIM（構造的類似度指標）`

---

## 🧪 データセット構築

- 使用モデル：**Poly Haven や Scanned Objects の65種のメッシュ**
- 総シーン数：**4680シーン**（回転・奥行きパターンを変化）
- Mitsuba3 の深度を Z 最適化し、**ノイズ除去・正規化**を実施

---

## 🧠 ネットワーク構造

- **Encoder**：`ReLU + MaxPooling`
- **Decoder**：
  - Albedo / Depth：`ReLU`
  - Normal：`LeakyReLU`
- **出力層**：`Sigmoid` または `Tanh` によるスケーリング

<!-- ←画像があれば挿入 -->

---

## 📊 評価結果

| Method              | Albedo MAE | Depth MAE | Normal Angular MAE |
|---------------------|------------|-----------|---------------------|
| Depth Anything V2   | -          | 0.3155    | -                   |
| DepthPro            | -          | 0.4373    | -                   |
| Marigold            | -          | 0.2368    | 19.24               |
| **Ours**            | **0.059**  | **0.1664**| **16.47**           |

- 提案手法は**深度・法線の両方で既存手法を上回る精度**を達成  
- **深度誤差：0.1664、法線誤差：16.47°**

---

## 📌 今後の課題

- 実写画像への適用  
- 非ランバート材質や未知光源への対応

---

## 📚 参考文献

- Horn, B.K.P., “Shape from Shading,” MIT Tech Report, 1970  
- Iwahori et al., “Point Source Illumination Stereo,” Computers & Graphics, 1990  
- Ronneberger et al., “U-Net,” MICCAI, 2015
